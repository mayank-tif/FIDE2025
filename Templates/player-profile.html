{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player Profile - FIDE World Cup 2025</title>
  <link rel="stylesheet" href="{% static 'assets/css/app.css' %}">
  <style>
    /* Add styles for multiple file upload */
    .file-upload-multiple {
        border: 2px dashed #ddd;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
        margin-bottom: 10px;
        margin-top: 8px;

    }
    
    .file-upload-multiple:hover {
        border-color: #5a8372;
        background: #f8f9fa;
    }
    
    .file-list {
        margin-top: 15px;
    }
    
    .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 12px;
        background: #e9ecef;
        border-radius: 4px;
        margin-bottom: 8px;
        font-size: 13px;
    }
    
    .file-info {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .file-size {
        color: #6c757d;
        font-size: 12px;
    }
    
    .remove-file {
        background: none;
        border: none;
        color: #dc3545;
        cursor: pointer;
        font-size: 16px;
        padding: 4px;
        border-radius: 3px;
    }
    
    .remove-file:hover {
        background: #dc3545;
        color: white;
    }
    
    .existing-documents {
        margin-top: 15px;
    }
    
    .document-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 15px;
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        margin-bottom: 10px;
        transition: all 0.3s ease;
    }
    
    .document-item:hover {
        background: #e9ecef;
        border-color: #5a8372;
    }
    
    .document-actions {
        display: flex;
        gap: 8px;
        align-items: center;
    }
    
    .btn--danger {
        background: #dc3545;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        text-decoration: none;
    }
    
    .btn--danger:hover {
        background: #c82333;
    }
    
    .btn--secondary {
        background: #6c757d;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        text-decoration: none;
    }
    
    .btn--secondary:hover {
        background: #545b62;
    }
    
    .file-icon {
        font-size: 18px;
        width: 24px;
        text-align: center;
    }
    
    .no-documents {
        text-align: center;
        color: #6c757d;
        padding: 1px;
        border: 2px dashed #ddd;
        border-radius: 8px;
    }
    /* Transportation Styles */
    .item-log {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .item-entry {
        background: white;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
    }

    .item-entry:hover {
        border-color: #5a8372;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .item-line {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 10px;
    }

    .item-line > div {
        flex: 1;
    }

    .details {
        color: #6c757d;
        font-size: 14px;
    }

    .route {
        color: #495057;
        font-weight: 500;
    }

    .datetime {
        color: #6c757d;
        font-size: 13px;
    }

    /* Badge Styles */
    .badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        text-transform: capitalize;
        white-space: nowrap;
    }

    {% comment %} .badge--info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
    }

    .badge--success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .badge--warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    } {% endcomment %}

    

    .no-data {
        text-align: center;
        padding: 40px 20px;
        color: #6c757d;
        font-style: italic;
    }


    .back-button {
        background: #6c757d;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        transition: background-color 0.2s;
    }

    .back-button:hover {
        background: #545b62;
        color: white;
        text-decoration: none;
    }

    .profile-title {
        flex: 1;
        margin: 0;
    }

    .transport-status-text {
        font-size: 14px;
        line-height: 1.4;
        margin-bottom: 5px;
    }

    .transport-updated {
        font-size: 12px;
        color: #6c757d;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .item-line {
            flex-direction: column;
            gap: 8px;
        }
        
        .item-line > div {
            width: 100%;
        }
        
        .profile-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        
        .back-button {
            align-self: flex-start;
        }
    }
    /* Roaster group */
.roaster-entry {
    background: #f8f9fa;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin-bottom: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.roaster-header {
    padding: 12px 15px;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.roaster-header:hover {
    background: #e9ecef;
}

.roaster-body {
    display: none;
    padding: 10px 15px 15px 15px;
    border-top: 1px solid #ddd;
    background: #fff;
    border-radius: 0 0 8px 8px;
}

/* Player transport entry inside Roaster */
.player-entry {
    border: 1px solid #e9ecef;
    border-radius: 6px;
    padding: 10px;
    margin-bottom: 10px;
    transition: all 0.3s ease;
}

.player-entry:hover {
    border-color: #5a8372;
    box-shadow: 0 1px 5px rgba(0,0,0,0.05);
}

.player-line {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 10px;
    cursor: pointer;
}

.player-body {
    display: none;
    margin-top: 8px;
    font-size: 13px;
    color: #495057;
}

/* Badge */
.badge {
    display: inline-flex;           /* allows centering content */
    align-items: center;            /* vertical center */
    justify-content: center;        /* horizontal center */
    width: 80px;                    /* fixed width for all badges */
    height: 28px;                   /* fixed height for all badges */
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    text-transform: capitalize;
    white-space: nowrap;            /* prevent text wrap */
    overflow: hidden;               /* cut overflow text */
    text-overflow: ellipsis;        /* show ... for long text */
    box-sizing: border-box; 
}

.badge--info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
.badge--success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.badge--warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
.badge--primary { background: #cce7ff; color: #004085; border: 1px solid #b3d7ff; }

.no-data { text-align: center; padding: 20px; color: #6c757d; font-style: italic; }
.profile-header {
    display: flex;
    flex-direction: column; /* stack arrow above name */
    align-items: flex-start;    /* center horizontally */
    gap: 5px;               /* small spacing between arrow and name */
    margin-bottom: 20px;
}

.back-arrow {
    font-size:495057 20px;
    cursor: pointer;
    color: #;
    transition: color 0.2s;
}

.back-arrow:hover {
    color: #5a8372;
}

.profile-title {
    margin: 0;
    font-size: 24px;
    text-align: center;
}

  </style>
</head>
<body>
  <div class="app-shell">
    {% include 'sidebar.html' %}
    <main class="main-content">
      <div class="profile-page">
        <div class="profile-header">
          <div class="back-arrow" id="backButton">‚Üê</div>
          <h1 class="profile-title" id="profile-player-name">{{ player.name }}</h1>
        </div>
        <div class="profile-tabs">
          <button class="tab-btn active" data-tab="profile">Profile</button>
          <button class="tab-btn" data-tab="transportation">Transportation</button>
        </div>

        <!-- Profile Tab -->
        <div id="tab-profile" class="tab-content active">
          <div class="profile-card">
            <div class="profile-photo-section">
              <div class="profile-avatar" id="profile-avatar" data-initials="{{ player.name|slice:':2' }}">
                {% if player.image %}
                  <img id="avatar-img" src="{{ player.image.url }}" alt="Profile Photo">
                {% endif %}
              </div>
              <button class="btn btn--secondary" id="upload-photo-btn">Upload Photo</button>
              <input type="file" id="upload-photo-input" accept="image/*" style="display: none;">
              <small>JPG, PNG max 2MB</small>
            </div>
            <form id="profile-form" class="profile-form">
              <div class="form-row">
                <div class="form-group">
                  <label for="profile-name">Name</label>
                  <input type="text" id="profile-name" name="name" value="{{ player.name }}" required>
                </div>
                <div class="form-group">
                  <label for="profile-fide-id">FIDE ID</label>
                  <input type="text" id="profile-fide-id" name="fide_id" value="{{ player.fide_id }}" required>
                </div>
                <div class="form-group">
                  <label for="profile-age">Age</label>
                  <input type="number" id="profile-age" name="age" value="{{ player.age }}">
                </div>
                <div class="form-group">
                  <label for="profile-gender">Gender</label>
                  <select id="profile-gender" name="gender">
                    <option value="">Select</option>
                    <option value="MALE" {% if player.gender == 'MALE' %}selected{% endif %}>Male</option>
                    <option value="FEMALE" {% if player.gender == 'FEMALE' %}selected{% endif %}>Female</option>
                    <option value="OTHER" {% if player.gender == 'OTHER' %}selected{% endif %}>Other</option>
                  </select>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="profile-country">Country</label>
                  <select id="profile-country" name="country">
                    <option value="">Select</option>
                    {% for country in countries %}
                      <option value="{{ country.country_id }}" {% if player.countryid_id == country.country_id %}selected{% endif %}>
                        {{ country.country_name }}
                      </option>
                    {% endfor %}
                  </select>
                </div>
                <div class="form-group">
                  <label for="profile-email">Email</label>
                  <input type="email" id="profile-email" name="email" value="{{ player.email }}" required>
                </div>
                <div class="form-group">
                  <label for="profile-status">Status</label>
                  <select id="profile-status" name="status" required>
                    <option value="ACTIVE" {% if player.status == 'ACTIVE' %}selected{% endif %}>Active</option>
                    <option value="DEPARTED" {% if player.status == 'DEPARTED' %}selected{% endif %}>Departed</option>
                    <option value="KNOCKED_OUT" {% if player.status == 'KNOCKED_OUT' %}selected{% endif %}>Knocked Out</option>
                  </select>
                </div>
              </div>

              <!-- Accompanying Persons Field -->
              <div class="form-row">
                <div class="form-group full-width">
                  <label for="profile-accompanying-persons">Accompanying Persons</label>
                  <input type="text" 
                         id="profile-accompanying-persons" 
                         name="accompanying_persons" 
                         value="{{ player.accompanying_persons|default:'' }}" 
                         placeholder="Enter names of accompanying persons separated by commas (e.g., John Doe, Jane Smith)">
                  <small>If traveling with family members or companions, please enter their full names separated by commas</small>
                </div>
              </div>

              <!-- Food Allergies Field -->
              <div class="form-row">
                <div class="form-group full-width">
                  <label for="profile-food-allergies">Food Allergies & Dietary Restrictions</label>
                  <textarea id="profile-food-allergies" name="food_allergies" rows="3" placeholder="Enter any food allergies or dietary restrictions. If none, please write 'None'." required>{{ player.details|default:'' }}</textarea>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="profile-room-cleaning">Room Cleaning Preference</label>
                  <select id="profile-room-cleaning" name="room_cleaning_preference" required>
                    <option value="MORNING" {% if player.room_cleaning_preference == 'MORNING' %}selected{% endif %}>Morning slot (while you are likely to be in the room)</option>
                    <option value="AFTERNOON" {% if player.room_cleaning_preference == 'AFTERNOON' %}selected{% endif %}>Between 3:00 PM ‚Äì 6:00 PM (during game hours)</option>
                    <option value="EVENING" {% if player.room_cleaning_preference == 'EVENING' %}selected{% endif %}>Evening slot (after games, while you are likely to be in the room)</option>
                    <option value="AT_HOTEL" {% if player.room_cleaning_preference == 'AT_HOTEL' %}selected{% endif %}>Will give instructions at hotel</option>                  
                  </select>
                </div>
                
                <!-- UPDATED: Multiple Documents Upload with Delete Option -->
                <div class="form-group">
                  <label>Documents</label>
                  <div class="documents-section">
                    <!-- Existing Documents -->
                    <div class="existing-documents" id="existing-documents">
                      {% for doc in player_documents %}
                        <div class="document-item" id="document-{{ doc.id }}">
                          <div class="file-info">
                            <span class="file-icon">üìÑ</span>
                            <div>
                              <div>{{ doc.original_filename }}</div>
                              <div class="file-size">{{ doc.file_size|filesizeformat }} ‚Ä¢ {{ doc.document_type }}</div>
                            </div>
                          </div>
                          <div class="document-actions">
                            <a href="{{ doc.reg_document.url }}" target="_blank" class="btn btn--primary">View</a>
                            <button type="button" class="btn btn--secondary remove-document-btn" data-document-id="{{ doc.id }}">Delete</button>
                          </div>
                        </div>
                      {% empty %}
                        <div class="no-documents">
                          <span>No documents uploaded</span>
                        </div>
                      {% endfor %}
                    </div>

                    <!-- Multiple File Upload -->
                    <div class="file-upload-multiple" id="fileUploadArea">
                      <div class="file-label">
                        <div style="font-size: 13px;"><strong>Click to upload</strong> or drag and drop</div>
                        <div style="font-size: 11px; margin-top: 3px;">PDF or Image files (Max 10 MB per file)</div>
                        <div style="font-size: 11px; margin-top: 2px;">You can select multiple files</div>
                      </div>
                    </div>
                    <input type="file" id="upload-document-input" name="documents" accept=".pdf,image/*" multiple style="display: none;">
                    <div class="file-list" id="fileList"></div>
                  </div>
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn btn--primary">Save Changes</button>
                <button type="button" class="btn btn--secondary" onclick="window.history.back()">Cancel</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Transportation Tab -->
        <div id="tab-transportation" class="tab-content">
          <div class="profile-card">
            <h3>Transportation Details</h3>
            <ul id="transport-log" class="item-log">
            </ul>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="{% static 'assets/js/app.js' %}"></script>

  <script>           
    document.addEventListener("DOMContentLoaded", function() {
      // Back Button Functionality
      const backButton = document.getElementById("backButton");
      backButton.addEventListener("click", function() {
        // Try to get the stored players list URL from sessionStorage
        const storedUrl = sessionStorage.getItem('playersListUrl');
        if (storedUrl) {
          window.location.href = "{% url 'players' %}" + storedUrl;
        } else {
          // Fallback to browser history or players list
          if (document.referrer && document.referrer.includes(window.location.hostname)) {
            window.history.back();
          } else {
            window.location.href = "{% url 'players' %}";
          }
        }
      });

      const profileForm = document.getElementById("profile-form");
      const uploadBtn = document.getElementById("upload-photo-btn");
      const uploadInput = document.getElementById("upload-photo-input");
      const fileUploadArea = document.getElementById("fileUploadArea");
      const uploadDocInput = document.getElementById("upload-document-input");
      const fileList = document.getElementById("fileList");
      const avatarDiv = document.getElementById("profile-avatar");
      const csrfToken = "{{ csrf_token }}";
      const playerId = "{{ player.id }}";

      let selectedFiles = [];

      // Open file picker for profile photo
      uploadBtn.addEventListener("click", () => uploadInput.click());

      // Open file picker for documents
      fileUploadArea.addEventListener("click", () => uploadDocInput.click());

      // Multiple file upload functionality
      uploadDocInput.addEventListener("change", function(e) {
        handleFiles(this.files);
      });

      // Drag and drop for documents
      fileUploadArea.addEventListener('dragover', function(e) {
        e.preventDefault();
        fileUploadArea.classList.add('dragover');
      });

      fileUploadArea.addEventListener('dragleave', function(e) {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
      });

      fileUploadArea.addEventListener('drop', function(e) {
        e.preventDefault();
        fileUploadArea.classList.remove('dragover');
        handleFiles(e.dataTransfer.files);
      });

      function handleFiles(files) {
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          
          // Check file size (10MB limit)
          if (file.size > 10 * 1024 * 1024) {
            showMessage(`File "${file.name}" exceeds 10 MB size limit. Please choose a smaller file.`);
            continue;
          }
          
          // Check if file already exists
          if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
            selectedFiles.push(file);
          }
        }
        updateFileList();
        updateFileInput();
      }

      function updateFileInput() {
        const dataTransfer = new DataTransfer();
        selectedFiles.forEach(file => {
          dataTransfer.items.add(file);
        });
        uploadDocInput.files = dataTransfer.files;
      }

      function updateFileList() {
        fileList.innerHTML = '';
        
        if (selectedFiles.length === 0) {
          return;
        }
        
        selectedFiles.forEach((file, index) => {
          const fileItem = document.createElement('div');
          fileItem.className = 'file-item';
          
          const fileSize = (file.size / 1024 / 1024).toFixed(2);
          
          fileItem.innerHTML = `
            <div class="file-info">
              <span>üìé</span>
              <span>${file.name}</span>
              <span class="file-size">(${fileSize} MB)</span>
            </div>
            <button type="button" class="remove-file" data-index="${index}">√ó</button>
          `;
          
          fileList.appendChild(fileItem);
        });

        // Add remove file handlers
        document.querySelectorAll('.remove-file').forEach(button => {
          button.addEventListener('click', function() {
            const index = parseInt(this.getAttribute('data-index'));
            selectedFiles.splice(index, 1);
            updateFileList();
            updateFileInput();
          });
        });
      }

      // Delete existing document functionality
      document.querySelectorAll('.remove-document-btn').forEach(button => {
        button.addEventListener('click', function() {
          const documentId = this.getAttribute('data-document-id');
          const documentElement = document.getElementById(`document-${documentId}`);
          const fileName = documentElement.querySelector('.file-info div:first-child').textContent;
          
          if (confirm(`Are you sure you want to delete "${fileName}"?`)) {
            const formData = new FormData();
            formData.append("document_id", documentId);
            formData.append("csrfmiddlewaretoken", csrfToken);
            
            fetch("{% url 'delete_player_document' %}", {
              method: "POST",
              body: formData
            })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                documentElement.remove();
                showMessage("Document deleted successfully!");
                
                // If no documents left, show empty state
                const existingDocuments = document.getElementById('existing-documents');
                if (existingDocuments.children.length === 0) {
                  existingDocuments.innerHTML = '<div class="no-documents"><span>No documents uploaded</span></div>';
                }
              } else {
                showMessage("Error deleting document: " + data.error);
              }
            })
            .catch(err => {
              console.error(err);
              showMessage("Something went wrong while deleting the document.");
            });
          }
        });
      });

      // Preview selected profile image instantly
      uploadInput.addEventListener("change", function() {
        if (this.files && this.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            let existingImg = document.getElementById("avatar-img");
            if (existingImg) {
              existingImg.src = e.target.result;
            } else {
              const img = document.createElement("img");
              img.id = "avatar-img";
              img.src = e.target.result;
              img.alt = "Profile Photo";
              avatarDiv.appendChild(img);
            }
          }
          reader.readAsDataURL(this.files[0]);
        }
      });

      // Handle profile form submission
      profileForm.addEventListener("submit", function(e) {
        e.preventDefault();

        const formData = new FormData();
        formData.append("player_id", playerId);
        formData.append("name", profileForm.name.value);
        formData.append("fide_id", profileForm.fide_id.value);
        formData.append("age", profileForm.age.value);
        formData.append("gender", profileForm.gender.value);
        formData.append("country", profileForm.country.value);
        formData.append("email", profileForm.email.value);
        formData.append("status", profileForm.status.value);
        formData.append("food_allergies", profileForm.food_allergies.value);
        formData.append("room_cleaning_preference", profileForm.room_cleaning_preference.value);
        formData.append("accompanying_persons", profileForm.accompanying_persons.value);

        if (uploadInput.files.length > 0) {
          formData.append("profile_pic", uploadInput.files[0]);
        }

        // Add all selected documents
        selectedFiles.forEach(file => {
          formData.append("documents", file);
        });

        fetch("{% url 'update_player_profile' %}", {
          method: "POST",
          headers: { "X-CSRFToken": csrfToken },
          body: formData
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            showMessage("Profile updated successfully!");
            setTimeout(() => window.location.reload(true), 1500);
          } else {
            showMessage("Error updating profile: " + (data.error || "Please try again."));
          }
        })
        .catch(err => {
          console.error(err);
          showMessage("Something went wrong.");
        });
      });

      // Tab switching functionality
      const tabs = document.querySelectorAll(".tab-btn");
      const tabContents = document.querySelectorAll(".tab-content");

      tabs.forEach(tab => {
        tab.addEventListener("click", () => {
          tabs.forEach(t => t.classList.remove("active"));
          tabContents.forEach(c => c.classList.remove("active"));

          tab.classList.add("active");
          const tabId = "tab-" + tab.dataset.tab;
          document.getElementById(tabId).classList.add("active");
        });
      });
    });
  </script>
  <script>
  document.addEventListener("DOMContentLoaded", function() {
  const transportLog = document.getElementById("transport-log");
  const playerId = "{{ player.id }}";

  function loadTransportData() {
    fetch(`/player/${playerId}/transport/`)
      .then(res => res.json())
      .then(data => {
        transportLog.innerHTML = "";

        if (!data || data.length === 0) {
          transportLog.innerHTML = '<li class="no-data">No transportation details found for this player.</li>';
          return;
        }

        // Group by roaster_id (or unique key for unassigned)
        const roasters = {};
        data.forEach(item => {
          const roasterKey = item.roaster_id || `unassigned-${item.id}`;
          if (!roasters[roasterKey]) {
            roasters[roasterKey] = {
              route: (item.pickup_location || item.drop_location)
                      ? `${item.pickup_location ?? ''} ‚Üí ${item.drop_location ?? ''}`
                      : item.entry_status == "ARRIVED_AIRPORT" ? 'Arrival' : item.entry_status == "REACHED_AIRPORT_DEPARTURE"? 'Departure' : "",
              entries: []
            };
          }
          roasters[roasterKey].entries.push(item);
        });
        const roasterArray = Object.values(roasters)
.map(group => {
  // Sort entries inside each roaster by id descending
  group.entries.sort((a, b) => b.id - a.id);
  
  return {
    roaster_id: group.entries[0].roaster_id || 0,
    route: group.route,
    route_type: group.route === 'Departure' ? 1 : 
                group.route.includes('‚Üí') ? 2 : 
                group.route === 'Arrival' ? 3 : 4, // Priority: Departure(1) -> Routes(2) -> Arrival(3)
    entries: group.entries
  };
})
// Sort by custom priority: Departure -> Routes -> Arrival
.sort((a, b) => {
  // First sort by route type priority
  if (a.route_type !== b.route_type) {
    return a.route_type - b.route_type;
  }
  // If same type, sort by roaster_id descending
  return b.roaster_id - a.roaster_id;
});
        
        // Now iterate over roasterArray instead of Object.values(roasters)
        roasterArray.forEach(roaster => {
          const li = document.createElement('li');
          li.className = 'roaster-entry';
          li.innerHTML = `
            <div class="roaster-header">${roaster.route} ‚ØÜ</div>
            <div class="roaster-body"></div>
          `;
          transportLog.appendChild(li);
          const body = li.querySelector('.roaster-body');
          body.style.display = 'none';

          roaster.entries.forEach(player => {
            const playerDiv = document.createElement('div');
            playerDiv.className = 'player-entry';
            const badgeClass = player.entry_status === 'STARTED' ? 'badge--info' : player.entry_status === 'ENDED' ? 'badge--success' : player.entry_status === 'SCHEDULED' ? 'badge--warning': "";
            const badgeText = player.entry_status === 'STARTED' ? 'Started' : player.entry_status === 'ENDED' ? "Ended" : player.entry_status === 'SCHEDULED' ? 'Scheduled' : '';
            playerDiv.innerHTML = `
              <div class="player-line">
                <div style="flex:1;">
                  <div class="transport-status-text">${player.status_display}</div>
                </div>
                <span class="badge ${badgeClass}">${badgeText}</span>
              </div>
              <div class="player-body">
                <p><strong>Player:</strong> ${player.player_name}</p>
                <p><strong>Route:</strong> ${player.pickup_location} ‚Üí ${player.drop_location}</p>
                ${player.travel_date ? `<p><strong>Travel Date:</strong> ${player.travel_date}</p>` : ''}
                ${player.vehicle_type ? `<p><strong>Vehicle:</strong> ${player.vehicle_type} ${player.vehicle_number}</p>` : ''}
                ${player.driver_name ? `<p><strong>Driver:</strong> ${player.driver_name} | ${player.driver_phone}</p>` : ''}
              </div>
            `;

            playerDiv.querySelector('.player-body').style.display = 'none';
            playerDiv.querySelector('.player-line').addEventListener('click', () => {
              const body = playerDiv.querySelector('.player-body');
              body.style.display = body.style.display === 'none' ? 'block' : 'none';
            });

            body.appendChild(playerDiv);
          });

          // Toggle roaster body
          li.querySelector('.roaster-header').addEventListener('click', () => {
            body.style.display = body.style.display === 'none' ? 'block' : 'none';
          });
        });
      })
      .catch(err => {
        console.error(err);
        transportLog.innerHTML = '<li class="no-data">Error loading transportation details.</li>';
      });
  }

  // Load initially if tab is active
  if (document.getElementById('tab-transportation').classList.contains('active')) {
    loadTransportData();
  }

  // Reload when transportation tab is clicked
  document.querySelector('[data-tab="transportation"]').addEventListener('click', loadTransportData);
});
</script>
</body>
</html>